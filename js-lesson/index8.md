## Web APIを叩いてみよう 前置き編
前のページまででJavaScriptの基本的な書き方を学ぶことができました。

次はWeb APIを叩くことをゴールに話を進めていきます。

前置き編では以下について説明をします。

- APIについて
- Web APIについて
- HTTPメソッドとCRUD
- 配列について
- JSONについて



### APIとは
まずAPIとは何かを考えてみます。

まずAPIという言葉です。
APIはApplication Programming Interfaceの略です。
英語で見るとなんだか難しそうですね・・・

APIをざっくり説明すると以下となります。
- とある機能を持ったプログラムAがあります。
- プログラムAは自分の機能を公開して、他のプログラムにも使わせてあげることにしました。
- プログラムAは自分の機能を使う場合の手順とデータフォーマットを決めました。これがAPIです。
- APIに対して処理してほしいデータを渡すと、処理結果を戻してくれます。

これ、どこかで見たものに似てませんか？

関数の仕組みとそっくりですよね。
引数と戻り値もあります。

実はAPIも関数の一種と考えることができます。


### Web APIとは
次にWeb APIです。

APIを呼び出す場合、実はいろいろな手順やデータフォーマットがあります。
その中でもWeb技術を利用するタイプのAPIをWeb APIと呼んでいます。

Web APIでは通信の仕組みとしてHTTPを使い、データフォーマットではXMLやJSONを使うことが多いです。

したがってアクセスの際にはURLを利用します。
データの渡し方はHTTPメソッドを使います。

通常、Web APIにはReferenceがありますので
実際にWeb APIを使う場合はReferenceを参照しながら
URL、データフォーマット、HTTPメソッドを選んでください。

#### HTTPメソッドとCRUD
JavaScript入門から離れてしまうので深追いしませんが、
Web APIでよく使われるHTTPメソッドはGET/POST/PUT/DELETEの4つです。

これはデータベースの基本処理であるCRUD（クラッド）と呼ばれる考え方に基づいています。
CRUDはCreate（作成）/Read（読み込み）/Update（更新）/Delete（削除）です。

基本的には以下のイメージで使われますが、
そもそもHTTPメソッドとCRUDは別ものなので完全に一致した使われ方にはなっていないのが現状です。
- GET - Read
- POST - Create
- PUT - Update
- DELETE - Delete

HTTPメソッドやCRUDについて詳しく知りたい人はググって見てください。


### 配列について
Web APIを扱うにあたって、最低限必要なデータの扱いに配列があります。

なぜ配列が必要かというと、多くのWeb APIではレスポンスに配列を含んでいるため、配列が理解できていないと受け取ったレスポンスを処理できないからです。

配列自体はそこまで難しい考え方ではないので、簡単に説明をしておきます。

まずは配列を体験してみましょう。

```
let hairetsu = ["1つ目のデータ","2つ目のデータ","3つ目のデータ"];
console.log(hairetsu);
```
<img src="./img/api1-01.png" width="50%"/>


ポイントは1行目で変数にデータを格納する際に、[]で囲んでいるところです。

[]の中にカンマ区切りでデータを入力することで、1つの変数の中に複数のデータをまとめて登録することができます。これが配列です。

コンソール画面の出力を見ると右向きの三角があるのでそこをクリックしてみてください。
登録したデータに番号が振られて保存されているのが分かると思います。
この番号を使って、登録したデータを個別に取り出すことができます。

```
console.log(hairetsu[0]);
console.log(hairetsu[1]);
console.log(hairetsu[2]);
```
<img src="./img/api1-02.png" width="50%"/>

ポイントは配列の登録が0始まりになっているということです。
1つ目の番号にアクセスする場合は0を指定、2つ目のデータにアクセスする場合は1を指定という風になっています。
コンピュータの処理上の問題なので、そういうものだと思って覚えてください。

これが配列の基本的な扱い方です。


ちなみに上記では配列に登録されているデータ数が3つだと分かっていたので手書きしましたが、登録されているデータが1つかもしれないし10000個かもしれない場合にどうすればいいのかという問題があります。

これも簡単に処理することが可能です。
「配列.lengh」という風にプログラムを書くと、配列の長さ（登録されているデータ数）が取得できまます。
数が分かってしまえば、あとはforループで処理が可能です。

サンプルコードは以下の通りです。
```
let hairetsu = ["1つ目のデータ","2つ目のデータ","3つ目のデータ","4つ目のデータ"];
for(let i = 0; i < hairetsu.length; i++){
  console.log(hairetsu[i]);
}
```
<img src="./img/api1-03.png" width="50%"/>

このように配列はfor文など他の文法と組合わせて使うことで強い力を発揮することができます。

今回はWeb APIのレスポンスを処理することが目的なので、配列の説明は以上です。

プログラミングの中で配列をどのように活用していくかはいろいろなアプローチがあるので、いろいろ調べたりコードを書いてみたりしてくださいね。


### JSONについて
#### データフォーマットについて
Web APIを扱うにあたって、データフォーマットとして押さえておきたいのがJSONです。

データフォーマットというのは、コンピュータ上でデータを扱うときのルールのことです。

例えばCSVであれば、それぞれの値をカンマで区切るというルールで作成します。

XMLであれば「<xxx>データ</xxx>」という風にデータをタグで囲むというルールでデータを作成します。

特定のアプリケーションでしか使われないフォーマットもあれば、一般的な形式として様々なアプリケーションで使われているフォーマットもあります。


いろいろなアプリケーションで共通のデータフォーマットが使われるメリットを考えてみましょう。

例えばシステムAからシステムBにデータを渡したいという場合を考えてみましょう。

もしデータフォーマットが違う場合はシステムAのデータフォーマットからシステムBのデータフォーマットに変換するプログラムを作成する必要があります。

システムAとシステムBの2つだけであればどうにかなるかもしれませんが、ではシステムが100種類あったらどうでしょう？
データフォーマット変換プログラムの数がものすごい数になってしまいますね。

この問題を解決するのが共通のデータフォーマットになります。
システム間で同じデータフォーマットが使えれば、データをそのまま渡して読み込んでもらうことができます。

JSONもこうしたデータフォーマットのひとつで、様々なアプリケーションで利用されています。


#### JSONのフォーマット
前置きが長くなりましたが、それでは本題のJSONです。

JSONはJavaScript Object Notationの略で、JavaScriptで使われていたデータフォーマットが広まったものです。

CSVがカンマ区切りでデータを記述するように、JSONも決まったルールでデータを記述します。

それではJSONのフォーマットを見てみましょう。
まずは基本系からです。

```
{ "name": "Tom" , "age": 30 }
```

JSONは外側を{}で囲み、中にデータを入力します。
データを入力する際はキー名と値をセットにしてコロンで区切って入力します。
※キー名は項目名くらいに思っておいてもらえれば大丈夫です。

キー名はダブルクオーテーションで囲みます。

値については文字列の場合はダブルクオーテーションで囲みますが、数値型など文字列として扱いたくない場合はダブルクオーテーションなしで書きます。

複数のキー名と値を扱いたい場合は、カンマで区切って入力します。
最後のキー名と値の後ろにはカンマは入らないので注意です。


データ量が増えると見難くなるので、以下のように改行とインデントを入れて見やすくすることが多いです。

```
{
  "name": "Tom" ,
   "age": 30
}
```


#### JavaScriptでJSONを扱ってみよう
JSONにすると何がいいの？っていう素朴な疑問が出てくると思いますので、疑問解消のためにJavaScriptでJSONを扱ってみましょう。


まずは簡単なJSONからはじめます。
コードは以下の通りです。

```
let sample_data = {
  "name": "Tom" ,
   "age": 30
};

console.log(sample_data.name);
console.log(sample_data.age);
```
<img src="./img/api1-04.png" width="50%"/>


まず最初に変数sample_dataにJSONデータを格納しています。

その後にconsole.log()でコンソール画面にJSONに格納したデータを表示しています。
その際に変数名.キー名という形でデータにアクセスできているのが分かるでしょうか。

このように変数名はキー名といった人間に分かりやすい情報を使ってデータにアクセスできるところが、JSONのメリットと言えます。

しんどいのでサンプルコードは書かないですが、これを単純な文字列の処理としてやろうとするとざっくり下のような流れになります・・・
1. 最初のnameまでの文字数を変え添える
2. nameの後ろに":"があるので、1の文字数から数えて4つ目が名前が始まる場所だと分かる。
3. 次に"が出てくる場所の文字数が最初から何文字目かを判定し、その1つ前までが名前が入力されている場所だと判断する
4. 2と3の範囲で文字を抜き出すと名前が取得できる


JSONの便利さが少しイメージできたでしょうか？



#### 複雑なJSONの例
実際にWeb APIを扱う場合は、もう少し複雑なJSONを扱います。

こちらも具体的な例を見ておきましょう。

まずは扱うJSONから。

```
{
  "service_name": "streaming_music",
  "plan": "free",
  "user_list": [
    {"name":"Tom","age":30,"favorite":["rock"]},
    {"name":"mary","age":27,"favorite":["rock","jazz"]},
    {"name":"george","age":50,"favorite":["classic"]}
  ]
}

```





[< 関数](./index7.html) | [Web APIを叩いてみよう >](./index9.html)



[0.JavaScriptについて](./index.html)
[1.ブラウザのConsole画面の使い方](./index2.html)
[2.変数の基本](./index3.html)
[3.順次処理](./index4.html)
[4.分岐処理](./index5.html)
[5.反復処理](./index6.html)
[6.関数](./index7.html)
[7.Web APIを叩いてみよう　前置き編](./index8.html)
[8.Web APIを叩いてみよう　実践編](./index9.html)
[9.HTMLと組み合わせて使ってみよう](./index10.html)
